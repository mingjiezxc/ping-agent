# ping-agent

## redis key

```bash
agent-list, set


agent-online_$ageent, key & timeout

// ping is err list 表, 定时检查 ip 时间段内是否有丢包，如无则移出。
agent-err-list_$agent, set
["xx", "xx",  "xx"]

// cron job list 名称
agent-jobs_$agent,  set 
val: ["xxx", "kkk", "ccc"]

// job status
agent_$agent_$jobname, key
{SPEC:"* * * * *" , name:"xxxx", group:["xxx", "ccc"]}


// group list
key: groups-list, set
val: ["xxx","ccc","bbb"]

// group 
key: group_$groupName, set
val: ["192.18.1.1", "192.168.2.1"]





// ip 状态最新, agent 监听 timeout 事件，如发生将 ip ，添加至 err list
key: ip_$agent_$ip,  key
{send_count, return_count, ip, err}

```


## agent Listen ICMP package
[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0xpc3RlbiBJQ01QIFNlcnZlcl0gLS0-fGdldCBpY21wIHBhY2thZ2V8IEIocmVhZCBwYWNrYWdlIGpvYilcbiAgICBCIC0tPnxtZW1vcnkgbWFwfCBGW2dldCBpcCB0dGxdXG4gICAgQiAtLT58aXAgaGVhZHwgRFtzcmMgaXBdXG4gICAgQiAtLT58cGFja2FnZSBib2R5fCBFW1VuaXggdGltZXN0YW1wXVxuICAgIEQgLS0-fHJlZGlzIGtleXwgR1tyZWRpcy1zZXJ2ZXJdXG4gICAgRSAtLT58cmVkaXMgdmFyfCBHXG4gICAgRiAtLT58cmVkaXMgdHRsfCBHIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/edit/###eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0VyciBJUCBMaXN0IEpvYiBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQ1tkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDEwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgRFtkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDYwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQiAtLT4gfGJvZHkgdW5pbnggdGltZXN0YW1wfEVbSUNNUCBQYWNrYWdlXVxuICAgIEUgLS0-IEZbYV1cblxuICAiLCJtZXJtYWlkIjoie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)

## agent jobs
[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0VyciBJUCBMaXN0IEpvYiBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQ1tkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDEwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgRFtkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDYwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQiAtLT4gfGJvZHkgdW5pbnggdGltZXN0YW1wfEVbSUNNUCBQYWNrYWdlXVxuICAgIEUgLS0-IHxzZW5kfEZbVHJhZ2VudCBJUF1cblxuICAiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0VyciBJUCBMaXN0IEpvYiBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQ1tkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDEwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgRFtkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDYwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQiAtLT4gfGJvZHkgdW5pbnggdGltZXN0YW1wfEVbSUNNUCBQYWNrYWdlXVxuICAgIEUgLS0-IHxzZW5kfCBGW1RyYWdlbnQgSVBdXG5cbiAgIiwibWVybWFpZCI6IntcbiAgXCJ0aGVtZVwiOiBcImRlZmF1bHRcIlxufSIsInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)


## update err IP list
[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0xpc3RlbiBJQ01QIFNlcnZlcl0gLS0-fGdldCBpY21wIHBhY2thZ2V8IEIocmVhZCBwYWNrYWdlIGpvYilcbiAgICBCIC0tPnxtZW1vcnkgbWFwfCBGW2dldCBpcCB0dGxdXG4gICAgQiAtLT58aXAgaGVhZHwgRFtzcmMgaXBdXG4gICAgQiAtLT58cGFja2FnZSBib2R5fCBFW1VuaXggdGltZXN0YW1wXVxuICAgIEQgLS0-fHJlZGlzIGtleXwgR1tyZWRpcy1zZXJ2ZXJdXG4gICAgRSAtLT58cmVkaXMgdmFyfCBHXG4gICAgRiAtLT58cmVkaXMgdHRsfCBHIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/edit/###eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW0VyciBJUCBMaXN0IEpvYiBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQ1tkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDEwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgRFtkZWZpbml0ZSB0aW1lIElQIExpc3QgSm9iIDYwcyBdIC0tPiBCKENyZWF0ZSBJQ01QIFBhY2thZ2UpXG4gICAgQiAtLT4gfGJvZHkgdW5pbnggdGltZXN0YW1wfEVbSUNNUCBQYWNrYWdlXVxuICAgIEUgLS0-IEZbYV1cblxuICAiLCJtZXJtYWlkIjoie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)